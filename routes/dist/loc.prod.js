"use strict";var express=require("express"),router=express.Router(),connection=require("../config/db"),iplocation=require("iplocation"),getCoords=require("city-to-coords");router.get("/",function(s,e){s.session&&s.session.user&&s.ip?(iplocation(s.ip,function(e,o){e&&console.log(e),o&&o.city?connection.query("UPDATE users SET city = ?, lat = ?, lon = ? WHERE username = ?",[o.city,o.latitude,o.longitude,s.session.user],function(e){e&&console.log(e)}):connection.query('UPDATE users SET city = "Lyon", lat = 45.739240, lon = 4.817450 WHERE username = ?',[s.session.user],function(e){e&&console.log(e)})}),s.session.success="Vous avez correctement été géolocaliser.",e.redirect("/")):(s.session.error="Vous devez être connecté pour accéder a cette page.",e.redirect("/login"))}),router.post("/",function(o,e){o.session&&o.session.user&&o.body&&o.body.city?(e.redirect("/"),getCoords(o.body.city).then(function(e){connection.query("UPDATE users SET city = ?, lat = ?, lon = ? WHERE username = ?",[o.body.city,e.lat,e.lng,o.session.user],function(e){e?console.log(e):o.session.success="Votre position a été mis a jour."})})):o.session&&o.session.user?(o.session.error="Vous devez renseigner une ville.",e.redirect("/profil")):(o.session.error="Vous devez être connecté pour accéder a cette page.",e.redirect("/login"))}),module.exports=router;